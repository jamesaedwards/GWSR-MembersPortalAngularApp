"use strict";(self.webpackChunkGWRTMembershipAngularApp=self.webpackChunkGWRTMembershipAngularApp||[]).push([[813],{8813:(E,d,s)=>{s.r(d),s.d(d,{RenewModule:()=>O});var u=s(9808),e=s(1223),m=s(6579),h=s(4720),_=s(520);let p=(()=>{class n{constructor(t){this.http=t,this.baseUrl=h.D.baseApiUrl}getRenewal(t){return console.log(t),this.http.get(this.baseUrl+"renew/identity/"+t)}completeRenewal(t){return this.http.post(this.baseUrl+"renew/HandleRenew",t)}requestRenewalSent(t){return this.http.post(this.baseUrl+"renew/RequestSecurityEmail",{email:t})}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(_.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var c=s(5271),r=s(2382);function f(n,i){1&n&&(e.TgZ(0,"p",8),e._uU(1,"This doesn't appear to be right."),e.qZA())}const g=function(){return["/renew/resend"]};let w=(()=>{class n{constructor(t,o){this.renewService=t,this.route=o,this.securityForm=new r.cw({renewSecurityLett:new r.NI("",[r.kI.required,r.kI.pattern("^[A-Z]{2}$")]),renewSecurityCode1:new r.NI("",[r.kI.required,r.kI.pattern("^[0-9]{4}$")]),renewSecurityCode2:new r.NI("",[r.kI.required,r.kI.pattern("^[0-9]{4}$")]),renewSecurityCode3:new r.NI("",[r.kI.required,r.kI.pattern("^[0-9]{4}$")])}),this.securityFormError="",this.securityForm2=new r.cw({securityCode:new r.NI("",[r.kI.required,r.kI.minLength(14),r.kI.maxLength(17),r.kI.pattern("^[A-Z]{2}[0-9]{12}$")])}),this.showLoading=new e.vpe,this.stopLoading=new e.vpe,this.onRenewalStarted=new e.vpe}getSecurityCode(){var t,o,a,l;return(null===(t=this.securityForm.get("renewSecurityLett"))||void 0===t?void 0:t.value)+"-"+(null===(o=this.securityForm.get("renewSecurityCode1"))||void 0===o?void 0:o.value)+(null===(a=this.securityForm.get("renewSecurityCode2"))||void 0===a?void 0:a.value)+(null===(l=this.securityForm.get("renewSecurityCode3"))||void 0===l?void 0:l.value)}getSecurityCode2(){var t;return null===(t=this.securityForm2.get("securityCode"))||void 0===t?void 0:t.value.replace(/ /g,"")}ngOnInit(){try{this.route.queryParams.subscribe(t=>{var o;null===(o=this.securityForm2.get("securityCode"))||void 0===o||o.setValue(t.id)}).unsubscribe(),""!==this.getSecurityCode2()&&(console.log("Code is: ",this.getSecurityCode2()),this.starRenewalProcess())}catch(t){}}starRenewalProcess(){if(console.log(this.getSecurityCode2()),this.showLoading.emit(),this.securityFormError="",0==this.securityForm2.valid)return this.securityFormError="Please check your security code, as it appears to be in the wrong format.",void this.stopLoading.emit();this.renewService.getRenewal(this.getSecurityCode2()).subscribe({next:t=>{this.renewalData=t,this.showLoading.emit(),this.onRenewalStarted.emit(t)},error:t=>{console.log(t),this.securityFormError=t.error.message,this.stopLoading.emit()},complete:()=>{this.stopLoading.emit()}})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(p),e.Y36(c.gz))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-security-lookup"]],outputs:{showLoading:"showLoading",stopLoading:"stopLoading",onRenewalStarted:"onRenewalStarted"},decls:16,vars:7,consts:[[1,"text-big"],[1,"text-error"],[3,"formGroup","submit"],[3,"className"],["id","security-code1","placeholder","AB123412341234","type","text","formControlName","securityCode","maxlength","17","autofocus","","oninput","this.value = this.value.toUpperCase()"],["class","text-error text-small",4,"ngIf"],["type","submit",1,"button",3,"disabled"],[3,"routerLink"],[1,"text-error","text-small"]],template:function(t,o){1&t&&(e.TgZ(0,"h2",0),e._uU(1,"Renewal Security Code"),e.qZA(),e.TgZ(2,"p"),e._uU(3,"Please enter the security code that was included in your renewal letter or email. Please don't include the spaces. The code is made up of 2 letters then 12 numbers."),e.qZA(),e.TgZ(4,"span",1),e._uU(5),e.qZA(),e.TgZ(6,"form",2),e.NdJ("submit",function(){return o.starRenewalProcess()}),e.TgZ(7,"div",3),e._UZ(8,"input",4),e.qZA(),e.YNc(9,f,2,0,"p",5),e.TgZ(10,"button",6),e._uU(11,"Start Renewal"),e.qZA()(),e.TgZ(12,"p"),e._uU(13,"Lost your security code?..."),e.TgZ(14,"a",7),e._uU(15,"Click Here"),e.qZA()()),2&t&&(e.xp6(5),e.Oqu(o.securityFormError),e.xp6(1),e.Q6J("formGroup",o.securityForm2),e.xp6(1),e.Q6J("className",o.securityForm2.controls.securityCode.invalid&&o.securityForm2.controls.securityCode.touched?"has-error input input-fullWidth":"input input-fullWidth"),e.xp6(2),e.Q6J("ngIf",o.securityForm2.controls.securityCode.invalid&&o.securityForm2.controls.securityCode.touched),e.xp6(1),e.Q6J("disabled",0==o.securityForm2.valid),e.xp6(4),e.Q6J("routerLink",e.DdM(6,g)))},directives:[r._Y,r.JL,r.sg,r.Fj,r.JJ,r.u,r.nD,u.O5,c.yS],styles:["input[_ngcontent-%COMP%]   .ng-valid[_ngcontent-%COMP%]{border:1px green solid}"]}),n})();var y=s(9285),v=s(5797),C=s(6635),T=s(819);function S(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"app-security-lookup",3),e.NdJ("showLoading",function(){return e.CHM(t),e.oxw().loading=!0})("stopLoading",function(){return e.CHM(t),e.oxw().loading=!1})("onRenewalStarted",function(a){return e.CHM(t),e.oxw().renewalData=a}),e.qZA()}}function Z(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"app-tarrifs-list",11),e.NdJ("onTarrifSelect",function(){return e.CHM(t),e.oxw(2).tarrifSelectedId=1}),e.qZA()}}function b(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"p")(1,"strong"),e._uU(2,"Change Membership: "),e.qZA(),e._uU(3),e.TgZ(4,"button",12),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).tarrifSelectedId=0}),e._uU(5,"Change"),e.qZA()()}if(2&n){const t=e.oxw(2);e.xp6(3),e.hij("",t.getSelectedTarrifDescription()," ")}}function R(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"app-payment-methods-table",13),e.NdJ("onMethodSelected",function(a){return e.CHM(t),e.oxw(2).selectedPaymentMethod=a}),e.qZA()}}function x(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"app-membership-declarations",14),e.NdJ("declarationsChange",function(a){return e.CHM(t),e.oxw(2).declarations=a}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("declarations",t.declarations)}}function I(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"button",15),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).sendRenewal()}),e._uU(1,"Pay and Renew"),e.qZA()}}const q=function(){return["/contact"]};function A(n,i){if(1&n&&(e.TgZ(0,"div")(1,"div",4)(2,"h2",5),e._uU(3),e.qZA(),e.TgZ(4,"p")(5,"strong"),e._uU(6,"Your Name: "),e.qZA(),e._uU(7),e._UZ(8,"br"),e.TgZ(9,"strong"),e._uU(10,"Email Address: "),e.qZA(),e._uU(11),e._UZ(12,"br"),e.TgZ(13,"strong"),e._uU(14,"Current Membership: "),e.qZA(),e._uU(15),e._UZ(16,"br"),e.TgZ(17,"strong"),e._uU(18,"Expiry Date: "),e.qZA(),e._uU(19),e.ALo(20,"date"),e._UZ(21,"br"),e.qZA(),e.TgZ(22,"p"),e._uU(23,"IMPORTANT: If your details or postal address has changed recently, pleases contact the "),e.TgZ(24,"a",6),e._uU(25,"Membership Secretary"),e.qZA(),e._uU(26,". "),e.qZA()(),e.YNc(27,Z,1,0,"app-tarrifs-list",7),e.YNc(28,b,6,1,"p",2),e.YNc(29,R,1,0,"app-payment-methods-table",8),e.YNc(30,x,1,1,"app-membership-declarations",9),e.YNc(31,I,2,0,"button",10),e.qZA()),2&n){const t=e.oxw();e.xp6(3),e.hij("Welcome ",t.renewalData.holderName,""),e.xp6(4),e.Oqu(t.renewalData.holderName),e.xp6(4),e.Oqu(t.renewalData.contactEmailAddress),e.xp6(4),e.Oqu(t.renewalData.currentTarrifDescription),e.xp6(4),e.Oqu(e.lcZ(20,11,t.renewalData.renewalDate)),e.xp6(5),e.Q6J("routerLink",e.DdM(13,q)),e.xp6(3),e.Q6J("ngIf",0===t.tarrifSelectedId),e.xp6(1),e.Q6J("ngIf",0!==t.tarrifSelectedId),e.xp6(1),e.Q6J("ngIf",0===t.selectedPaymentMethod&&0!==t.tarrifSelectedId),e.xp6(1),e.Q6J("ngIf",0!==t.selectedPaymentMethod&&0!==t.tarrifSelectedId),e.xp6(1),e.Q6J("ngIf",0!==t.selectedPaymentMethod)}}function D(n,i){1&n&&e._UZ(0,"app-please-waitpopup")}function F(n,i){1&n&&(e.TgZ(0,"p",7),e._uU(1,"This doesn't appear to be right."),e.qZA())}const L=function(){return["/contact"]};function k(n,i){1&n&&(e.TgZ(0,"div",8)(1,"p"),e._uU(2,"Your request has been sent. If we match your email address in our database, we will email the renewal invite. If you don't recieve anything within the next 24 hours, please contact the "),e.TgZ(3,"a",9),e._uU(4,"membership secretary"),e.qZA()()()),2&n&&(e.xp6(3),e.Q6J("routerLink",e.DdM(1,L)))}const J=[{path:"",component:(()=>{class n{constructor(t,o,a){this.tarrifsService=t,this.renewalService=o,this.router=a,this.step=1,this.loading=!1,this.selectedPaymentMethod=0,this.tarrifSelectedId=0,this.declarations={termsAccepted:!0,additonalDonation:0,additonalDonationRepeatOnRenewal:!1,giftAidDecl:"",cornishman:0},this.renewalDataDTO={additionalDonation:0,giftAidDeclaration:!1,securityCode:0,repeatDonationOnRenewal:!1,cornishman:0,membershipTarrifId:0,selectPaymentMethod:0}}ngOnInit(){}getSelectedTarrifDescription(){return this.tarrifsService.selectedCategory.name+" - "+this.tarrifsService.selectedTarrif.description}sendRenewal(){this.renewalDataDTO.additionalDonation=this.declarations.additonalDonation,this.renewalDataDTO.cornishman=this.declarations.cornishman,this.renewalDataDTO.membershipTarrifId=this.tarrifsService.getSelectedTarrifId(),this.renewalDataDTO.securityCode=this.renewalData.renewalSecurityCode,this.renewalDataDTO.selectPaymentMethod=this.selectedPaymentMethod,this.renewalDataDTO.giftAidDeclaration="true"===this.declarations.giftAidDecl,console.log(this.renewalDataDTO),this.loading=!0,this.renewalService.completeRenewal(this.renewalDataDTO).subscribe({next:t=>{this.loading=!1,window.location.href=t.paymentUrl},error:t=>{alert("There was an error: "+t),this.loading=!1}})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(m.B),e.Y36(p),e.Y36(c.gz))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-renewhome"]],decls:6,vars:3,consts:[[1,"text-huge"],[3,"showLoading","stopLoading","onRenewalStarted",4,"ngIf"],[4,"ngIf"],[3,"showLoading","stopLoading","onRenewalStarted"],[1,"border-bottom","mb-medium"],[1,"text-big"],[3,"routerLink"],[3,"onTarrifSelect",4,"ngIf"],[3,"onMethodSelected",4,"ngIf"],[3,"declarations","declarationsChange",4,"ngIf"],["class","button button--large",3,"click",4,"ngIf"],[3,"onTarrifSelect"],[1,"button","button--small",3,"click"],[3,"onMethodSelected"],[3,"declarations","declarationsChange"],[1,"button","button--large",3,"click"]],template:function(t,o){1&t&&(e.TgZ(0,"h1",0),e._uU(1,"Renew your membership"),e.qZA(),e._UZ(2,"hr"),e.YNc(3,S,1,0,"app-security-lookup",1),e.YNc(4,A,32,14,"div",2),e.YNc(5,D,1,0,"app-please-waitpopup",2)),2&t&&(e.xp6(3),e.Q6J("ngIf",null==o.renewalData),e.xp6(1),e.Q6J("ngIf",null!=o.renewalData),e.xp6(1),e.Q6J("ngIf",o.loading))},directives:[u.O5,w,c.yS,y.z,v.v,C._,T.J],pipes:[u.uU],styles:[""]}),n})()},{path:"resend",component:(()=>{class n{constructor(t){this.renewService=t,this.isSent=!1,this.requestForm=new r.cw({email:new r.NI("",[r.kI.required,r.kI.email])})}ngOnInit(){}send(){var t;0!=this.requestForm.valid&&this.renewService.requestRenewalSent(null===(t=this.requestForm.get("email"))||void 0===t?void 0:t.value).subscribe({next:o=>this.isSent=!0,error:o=>alert("Sorry, a server error occured. Please try again later.")})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(p))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-request-invite-email"]],decls:13,vars:5,consts:[[1,"text-huge"],[3,"formGroup","submit"],[3,"className"],["id","email","type","text","formControlName","email"],["class","text-error text-small",4,"ngIf"],["type","submit",1,"button",3,"disabled"],["class","notification notification--success",4,"ngIf"],[1,"text-error","text-small"],[1,"notification","notification--success"],[3,"routerLink"]],template:function(t,o){1&t&&(e.TgZ(0,"h1",0),e._uU(1,"Lost Security Code"),e.qZA(),e.TgZ(2,"p"),e._uU(3,"Haven't got or lost your renewal security code? Enter your email address below and we will resend it to you. "),e.qZA(),e.TgZ(4,"p"),e._uU(5,"Please note that this will only work if we have an up-to-date email addresss on record for you. If you don't then you will need contact the membership secretary"),e.qZA(),e.TgZ(6,"form",1),e.NdJ("submit",function(){return o.send()}),e.TgZ(7,"div",2),e._UZ(8,"input",3),e.qZA(),e.YNc(9,F,2,0,"p",4),e.TgZ(10,"button",5),e._uU(11,"Send Request"),e.qZA()(),e.YNc(12,k,5,2,"div",6)),2&t&&(e.xp6(6),e.Q6J("formGroup",o.requestForm),e.xp6(1),e.Q6J("className",o.requestForm.controls.email.invalid&&o.requestForm.controls.email.touched?"has-error input input-fullWidth":"input input-fullWidth"),e.xp6(2),e.Q6J("ngIf",o.requestForm.controls.email.invalid&&o.requestForm.controls.email.touched),e.xp6(1),e.Q6J("disabled",0==o.requestForm.valid),e.xp6(2),e.Q6J("ngIf",o.isSent))},directives:[r._Y,r.JL,r.sg,r.Fj,r.JJ,r.u,u.O5,c.yS],styles:[""]}),n})()}];let M=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[c.Bz.forChild(J),u.ez],c.Bz]}),n})();var N=s(4466);let O=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[M,r.UX,r.u5,u.ez,N.m,c.Bz]]}),n})()}}]);