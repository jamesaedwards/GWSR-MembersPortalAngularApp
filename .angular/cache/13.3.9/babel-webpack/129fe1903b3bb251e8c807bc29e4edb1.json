{"ast":null,"code":"import _asyncToGenerator from \"C:\\\\Users\\\\james\\\\source\\\\repos\\\\GWRTMemberAngularApp\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";\nimport { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nlet JoinHomeComponent = class JoinHomeComponent {\n  constructor(tarrifsService, joinService) {\n    this.tarrifsService = tarrifsService;\n    this.joinService = joinService;\n    this.step = 1;\n    this.selectedCategory = 0;\n    this.selectedTarrif = 0;\n    this.selectedTarrifDescription = \"\";\n    this.selectedPaymentMethod = 0; //4 = Direct Debit, 5 = Credit Card.\n\n    this.declarations = {\n      termsAccepted: true,\n      additonalDonation: 0,\n      additonalDonationRepeatOnRenewal: false,\n      giftAidDecl: '',\n      cornishman: 0\n    };\n    this.showExistingEmailWarining = false;\n    this.additionalSeatHolders = [];\n    this.loading = true;\n    this.tarrifs = [];\n  }\n\n  getSelectedTarrifDescription() {\n    return this.tarrifsService.selectedCategory.name + \" - \" + this.tarrifsService.selectedTarrif.description;\n  }\n\n  ngOnInit() {\n    this.tarrifsService.getTarrifs().subscribe({\n      next: r => {\n        this.tarrifs = r;\n        this.loading = false;\n\n        error: () => this.loading = false;\n      }\n    });\n  }\n\n  SetTarrif(selectedTarrif) {\n    // this.selectedTarrif =selectedTarrif.tarrif;\n    // let thisCategory = this.tarrifs.find(i=>i.id == selectedTarrif.category);\n    // this.selectedTarrifDescription = thisCategory?.name + \" - \" + thisCategory?.tarrifs.find(r=>r.id == selectedTarrif.tarrif)?.description;\n    // this.selectedTarrifBaseRate = thisCategory?.tarrifs.find(r=>r.id == selectedTarrif.tarrif)?.rate!;\n    this.step = 2;\n    this.toTop();\n  }\n\n  addAdditionalSeat(additionalPerson) {\n    this.additionalSeatHolders.push(additionalPerson);\n  }\n\n  resetTarrif() {\n    this.selectedTarrifDescription = \"\";\n    this.selectedTarrif = 0;\n    this.step = 1;\n    this.toTop();\n  }\n\n  getTarrifSeats() {\n    return this.tarrifsService.getSelectedTarrifSeats();\n  }\n\n  setPersonalDetails(person) {\n    this.toTop();\n    this.personBasicDetails = person;\n    this.joinService.checkEmail(this.personBasicDetails.email).subscribe(r => {\n      this.showExistingEmailWarining = r;\n    });\n\n    if (this.getTarrifSeats() > 1) {\n      this.step = 3;\n      return;\n    }\n\n    this.step = 4;\n  }\n\n  setAddress(ad) {\n    this.address = ad;\n    this.address.id = '00000000-0000-0000-0000-000000000000';\n    this.step = 5;\n    this.toTop();\n  }\n  /*\r\n  async  registerMember(){\r\n     this.loading = true;\r\n      await this.createPerson().then(async () => {\r\n       await this.createAddress().then(async () => {\r\n        await this.createMembership();\r\n       }).catch((e) => {\r\n          alert(e);\r\n       }).catch((e) => {\r\n        alert(e);\r\n       });\r\n      }).catch((e) => {\r\n        alert(e);\r\n      });\r\n  \r\n    }\r\n  async createPerson(){\r\n    this.joinService.createPerson(this.personBasicDetails).subscribe(r => {\r\n      this.personGuid = r;\r\n      this.address.id = r;\r\n      return r;\r\n    }).unsubscribe();\r\n  }\r\n  async createAddress(){\r\n    setTimeout(() => {\r\n      this.joinService.createAddress(this.address).subscribe(r=> {\r\n        return;\r\n      }).unsubscribe();\r\n     }, 500);\r\n  \r\n  } */\n\n\n  createMembership() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      _this.loading = true;\n      let requestDTO = {\n        membership: {\n          selectedPaymentMethod: _this.selectedPaymentMethod,\n          personId: _this.personGuid,\n          additionalDonation: _this.declarations.additonalDonation,\n          repeatDonationOnRenewal: _this.declarations.additonalDonationRepeatOnRenewal,\n          jointHolders: _this.additionalSeatHolders,\n          membershipTarrifId: _this.tarrifsService.selectedTarrif.id,\n          giftAidDeclaration: _this.declarations.giftAidDecl === 'true' ? true : false,\n          cornishman: _this.cornishman\n        },\n        person: _this.personBasicDetails,\n        address: _this.address\n      };\n\n      _this.joinService.createMembership(requestDTO).subscribe({\n        next: r => {\n          _this.loading = false;\n          _this.step = 7;\n          window.location.href = r.paymentUrl;\n          return;\n        },\n        error: e => {\n          alert(\"We are sorry, but we couldn't create your membership at this time. Please try again later or contact the membership secretary.\");\n          _this.loading = false;\n        }\n      });\n    })();\n  }\n\n  toTop() {\n    window.scroll(0, 0);\n  }\n\n};\nJoinHomeComponent = __decorate([Component({\n  selector: 'app-join-home',\n  templateUrl: './join-home.component.html',\n  styleUrls: ['./join-home.component.scss']\n})], JoinHomeComponent);\nexport { JoinHomeComponent };","map":{"version":3,"sources":["C:/Users/james/source/repos/GWRTMemberAngularApp/src/app/join/join-home/join-home.component.ts"],"names":["__decorate","Component","JoinHomeComponent","constructor","tarrifsService","joinService","step","selectedCategory","selectedTarrif","selectedTarrifDescription","selectedPaymentMethod","declarations","termsAccepted","additonalDonation","additonalDonationRepeatOnRenewal","giftAidDecl","cornishman","showExistingEmailWarining","additionalSeatHolders","loading","tarrifs","getSelectedTarrifDescription","name","description","ngOnInit","getTarrifs","subscribe","next","r","error","SetTarrif","toTop","addAdditionalSeat","additionalPerson","push","resetTarrif","getTarrifSeats","getSelectedTarrifSeats","setPersonalDetails","person","personBasicDetails","checkEmail","email","setAddress","ad","address","id","createMembership","requestDTO","membership","personId","personGuid","additionalDonation","repeatDonationOnRenewal","jointHolders","membershipTarrifId","giftAidDeclaration","window","location","href","paymentUrl","e","alert","scroll","selector","templateUrl","styleUrls"],"mappings":";AAAA,SAASA,UAAT,QAA2B,OAA3B;AACA,SAASC,SAAT,QAA0B,eAA1B;AACA,IAAIC,iBAAiB,GAAG,MAAMA,iBAAN,CAAwB;AAC5CC,EAAAA,WAAW,CAACC,cAAD,EAAiBC,WAAjB,EAA8B;AACrC,SAAKD,cAAL,GAAsBA,cAAtB;AACA,SAAKC,WAAL,GAAmBA,WAAnB;AACA,SAAKC,IAAL,GAAY,CAAZ;AACA,SAAKC,gBAAL,GAAwB,CAAxB;AACA,SAAKC,cAAL,GAAsB,CAAtB;AACA,SAAKC,yBAAL,GAAiC,EAAjC;AACA,SAAKC,qBAAL,GAA6B,CAA7B,CAPqC,CAOL;;AAChC,SAAKC,YAAL,GAAoB;AAChBC,MAAAA,aAAa,EAAE,IADC;AAEhBC,MAAAA,iBAAiB,EAAE,CAFH;AAGhBC,MAAAA,gCAAgC,EAAE,KAHlB;AAIhBC,MAAAA,WAAW,EAAE,EAJG;AAKhBC,MAAAA,UAAU,EAAE;AALI,KAApB;AAOA,SAAKC,yBAAL,GAAiC,KAAjC;AACA,SAAKC,qBAAL,GAA6B,EAA7B;AACA,SAAKC,OAAL,GAAe,IAAf;AACA,SAAKC,OAAL,GAAe,EAAf;AACH;;AACDC,EAAAA,4BAA4B,GAAG;AAC3B,WAAO,KAAKjB,cAAL,CAAoBG,gBAApB,CAAqCe,IAArC,GAA4C,KAA5C,GAAoD,KAAKlB,cAAL,CAAoBI,cAApB,CAAmCe,WAA9F;AACH;;AACDC,EAAAA,QAAQ,GAAG;AACP,SAAKpB,cAAL,CAAoBqB,UAApB,GAAiCC,SAAjC,CAA2C;AACvCC,MAAAA,IAAI,EAAGC,CAAD,IAAO;AACT,aAAKR,OAAL,GAAeQ,CAAf;AACA,aAAKT,OAAL,GAAe,KAAf;;AACAU,QAAAA,KAAK,EAAE,MAAM,KAAKV,OAAL,GAAe,KAArB;AACV;AALsC,KAA3C;AAOH;;AACDW,EAAAA,SAAS,CAACtB,cAAD,EAAiB;AACtB;AACA;AACA;AACA;AACA,SAAKF,IAAL,GAAY,CAAZ;AACA,SAAKyB,KAAL;AACH;;AACDC,EAAAA,iBAAiB,CAACC,gBAAD,EAAmB;AAChC,SAAKf,qBAAL,CAA2BgB,IAA3B,CAAgCD,gBAAhC;AACH;;AACDE,EAAAA,WAAW,GAAG;AACV,SAAK1B,yBAAL,GAAiC,EAAjC;AACA,SAAKD,cAAL,GAAsB,CAAtB;AACA,SAAKF,IAAL,GAAY,CAAZ;AACA,SAAKyB,KAAL;AACH;;AACDK,EAAAA,cAAc,GAAG;AACb,WAAO,KAAKhC,cAAL,CAAoBiC,sBAApB,EAAP;AACH;;AACDC,EAAAA,kBAAkB,CAACC,MAAD,EAAS;AACvB,SAAKR,KAAL;AACA,SAAKS,kBAAL,GAA0BD,MAA1B;AACA,SAAKlC,WAAL,CAAiBoC,UAAjB,CAA4B,KAAKD,kBAAL,CAAwBE,KAApD,EAA2DhB,SAA3D,CAAqEE,CAAC,IAAI;AACtE,WAAKX,yBAAL,GAAiCW,CAAjC;AACH,KAFD;;AAGA,QAAI,KAAKQ,cAAL,KAAwB,CAA5B,EAA+B;AAC3B,WAAK9B,IAAL,GAAY,CAAZ;AACA;AACH;;AACD,SAAKA,IAAL,GAAY,CAAZ;AACH;;AACDqC,EAAAA,UAAU,CAACC,EAAD,EAAK;AACX,SAAKC,OAAL,GAAeD,EAAf;AACA,SAAKC,OAAL,CAAaC,EAAb,GAAkB,sCAAlB;AACA,SAAKxC,IAAL,GAAY,CAAZ;AACA,SAAKyB,KAAL;AACH;AACD;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACUgB,EAAAA,gBAAgB,GAAG;AAAA;;AAAA;AACrB,MAAA,KAAI,CAAC5B,OAAL,GAAe,IAAf;AACA,UAAI6B,UAAU,GAAG;AACbC,QAAAA,UAAU,EAAE;AACRvC,UAAAA,qBAAqB,EAAE,KAAI,CAACA,qBADpB;AAERwC,UAAAA,QAAQ,EAAE,KAAI,CAACC,UAFP;AAGRC,UAAAA,kBAAkB,EAAE,KAAI,CAACzC,YAAL,CAAkBE,iBAH9B;AAIRwC,UAAAA,uBAAuB,EAAE,KAAI,CAAC1C,YAAL,CAAkBG,gCAJnC;AAKRwC,UAAAA,YAAY,EAAE,KAAI,CAACpC,qBALX;AAMRqC,UAAAA,kBAAkB,EAAE,KAAI,CAACnD,cAAL,CAAoBI,cAApB,CAAmCsC,EAN/C;AAORU,UAAAA,kBAAkB,EAAE,KAAI,CAAC7C,YAAL,CAAkBI,WAAlB,KAAkC,MAAlC,GAA2C,IAA3C,GAAkD,KAP9D;AAQRC,UAAAA,UAAU,EAAE,KAAI,CAACA;AART,SADC;AAWbuB,QAAAA,MAAM,EAAE,KAAI,CAACC,kBAXA;AAYbK,QAAAA,OAAO,EAAE,KAAI,CAACA;AAZD,OAAjB;;AAcA,MAAA,KAAI,CAACxC,WAAL,CAAiB0C,gBAAjB,CAAkCC,UAAlC,EAA8CtB,SAA9C,CAAwD;AACpDC,QAAAA,IAAI,EAAGC,CAAD,IAAO;AACT,UAAA,KAAI,CAACT,OAAL,GAAe,KAAf;AACA,UAAA,KAAI,CAACb,IAAL,GAAY,CAAZ;AACAmD,UAAAA,MAAM,CAACC,QAAP,CAAgBC,IAAhB,GAAuB/B,CAAC,CAACgC,UAAzB;AACA;AACH,SANmD;AAOpD/B,QAAAA,KAAK,EAAGgC,CAAD,IAAO;AACVC,UAAAA,KAAK,CAAC,gIAAD,CAAL;AACA,UAAA,KAAI,CAAC3C,OAAL,GAAe,KAAf;AACH;AAVmD,OAAxD;AAhBqB;AA4BxB;;AACDY,EAAAA,KAAK,GAAG;AACJ0B,IAAAA,MAAM,CAACM,MAAP,CAAc,CAAd,EAAiB,CAAjB;AACH;;AArI2C,CAAhD;AAuIA7D,iBAAiB,GAAGF,UAAU,CAAC,CAC3BC,SAAS,CAAC;AACN+D,EAAAA,QAAQ,EAAE,eADJ;AAENC,EAAAA,WAAW,EAAE,4BAFP;AAGNC,EAAAA,SAAS,EAAE,CAAC,4BAAD;AAHL,CAAD,CADkB,CAAD,EAM3BhE,iBAN2B,CAA9B;AAOA,SAASA,iBAAT","sourcesContent":["import { __decorate } from \"tslib\";\r\nimport { Component } from '@angular/core';\r\nlet JoinHomeComponent = class JoinHomeComponent {\r\n    constructor(tarrifsService, joinService) {\r\n        this.tarrifsService = tarrifsService;\r\n        this.joinService = joinService;\r\n        this.step = 1;\r\n        this.selectedCategory = 0;\r\n        this.selectedTarrif = 0;\r\n        this.selectedTarrifDescription = \"\";\r\n        this.selectedPaymentMethod = 0; //4 = Direct Debit, 5 = Credit Card.\r\n        this.declarations = {\r\n            termsAccepted: true,\r\n            additonalDonation: 0,\r\n            additonalDonationRepeatOnRenewal: false,\r\n            giftAidDecl: '',\r\n            cornishman: 0\r\n        };\r\n        this.showExistingEmailWarining = false;\r\n        this.additionalSeatHolders = [];\r\n        this.loading = true;\r\n        this.tarrifs = [];\r\n    }\r\n    getSelectedTarrifDescription() {\r\n        return this.tarrifsService.selectedCategory.name + \" - \" + this.tarrifsService.selectedTarrif.description;\r\n    }\r\n    ngOnInit() {\r\n        this.tarrifsService.getTarrifs().subscribe({\r\n            next: (r) => {\r\n                this.tarrifs = r;\r\n                this.loading = false;\r\n                error: () => this.loading = false;\r\n            }\r\n        });\r\n    }\r\n    SetTarrif(selectedTarrif) {\r\n        // this.selectedTarrif =selectedTarrif.tarrif;\r\n        // let thisCategory = this.tarrifs.find(i=>i.id == selectedTarrif.category);\r\n        // this.selectedTarrifDescription = thisCategory?.name + \" - \" + thisCategory?.tarrifs.find(r=>r.id == selectedTarrif.tarrif)?.description;\r\n        // this.selectedTarrifBaseRate = thisCategory?.tarrifs.find(r=>r.id == selectedTarrif.tarrif)?.rate!;\r\n        this.step = 2;\r\n        this.toTop();\r\n    }\r\n    addAdditionalSeat(additionalPerson) {\r\n        this.additionalSeatHolders.push(additionalPerson);\r\n    }\r\n    resetTarrif() {\r\n        this.selectedTarrifDescription = \"\";\r\n        this.selectedTarrif = 0;\r\n        this.step = 1;\r\n        this.toTop();\r\n    }\r\n    getTarrifSeats() {\r\n        return this.tarrifsService.getSelectedTarrifSeats();\r\n    }\r\n    setPersonalDetails(person) {\r\n        this.toTop();\r\n        this.personBasicDetails = person;\r\n        this.joinService.checkEmail(this.personBasicDetails.email).subscribe(r => {\r\n            this.showExistingEmailWarining = r;\r\n        });\r\n        if (this.getTarrifSeats() > 1) {\r\n            this.step = 3;\r\n            return;\r\n        }\r\n        this.step = 4;\r\n    }\r\n    setAddress(ad) {\r\n        this.address = ad;\r\n        this.address.id = '00000000-0000-0000-0000-000000000000';\r\n        this.step = 5;\r\n        this.toTop();\r\n    }\r\n    /*\r\n    async  registerMember(){\r\n       this.loading = true;\r\n        await this.createPerson().then(async () => {\r\n         await this.createAddress().then(async () => {\r\n          await this.createMembership();\r\n         }).catch((e) => {\r\n            alert(e);\r\n         }).catch((e) => {\r\n          alert(e);\r\n         });\r\n        }).catch((e) => {\r\n          alert(e);\r\n        });\r\n    \r\n      }\r\n    async createPerson(){\r\n      this.joinService.createPerson(this.personBasicDetails).subscribe(r => {\r\n        this.personGuid = r;\r\n        this.address.id = r;\r\n        return r;\r\n      }).unsubscribe();\r\n    }\r\n    async createAddress(){\r\n      setTimeout(() => {\r\n        this.joinService.createAddress(this.address).subscribe(r=> {\r\n          return;\r\n        }).unsubscribe();\r\n       }, 500);\r\n    \r\n    } */\r\n    async createMembership() {\r\n        this.loading = true;\r\n        let requestDTO = {\r\n            membership: {\r\n                selectedPaymentMethod: this.selectedPaymentMethod,\r\n                personId: this.personGuid,\r\n                additionalDonation: this.declarations.additonalDonation,\r\n                repeatDonationOnRenewal: this.declarations.additonalDonationRepeatOnRenewal,\r\n                jointHolders: this.additionalSeatHolders,\r\n                membershipTarrifId: this.tarrifsService.selectedTarrif.id,\r\n                giftAidDeclaration: this.declarations.giftAidDecl === 'true' ? true : false,\r\n                cornishman: this.cornishman\r\n            },\r\n            person: this.personBasicDetails,\r\n            address: this.address\r\n        };\r\n        this.joinService.createMembership(requestDTO).subscribe({\r\n            next: (r) => {\r\n                this.loading = false;\r\n                this.step = 7;\r\n                window.location.href = r.paymentUrl;\r\n                return;\r\n            },\r\n            error: (e) => {\r\n                alert(\"We are sorry, but we couldn't create your membership at this time. Please try again later or contact the membership secretary.\");\r\n                this.loading = false;\r\n            }\r\n        });\r\n    }\r\n    toTop() {\r\n        window.scroll(0, 0);\r\n    }\r\n};\r\nJoinHomeComponent = __decorate([\r\n    Component({\r\n        selector: 'app-join-home',\r\n        templateUrl: './join-home.component.html',\r\n        styleUrls: ['./join-home.component.scss']\r\n    })\r\n], JoinHomeComponent);\r\nexport { JoinHomeComponent };\r\n"]},"metadata":{},"sourceType":"module"}